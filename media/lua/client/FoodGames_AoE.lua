--[[██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████
   ░▒▓█████▓▒░     ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓███████▓▒░   ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓███████▓▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
  ░▒▓█▓▒░          ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
  ░▒▓█▓▒▒▓███▓▒░   ░▒▓█▓▒░         ░▒▓██████▓▒░      ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█████████▓▒░     ░▒▓███▓▒░     ░▒▓███████▓▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒▓▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒█▒░
   ░▒▓██████▓▒░    ░▒▓████████▓▒░    ░▒▓█▓▒░         ░▒▓█▓▒░      ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓█▓▒░  ░▒█▒░
|‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾|
|                        				 Custom  PZ  Mod  Developer  for  Hire													  |
|‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾|
|                       	Portfolio:  https://steamcommunity.com/id/glytch3r/myworkshopfiles/							          |
|                       		                                    														 	  |
|                       	Discord:    Glytch3r#1337 / glytch3r															      |
|                       		                                    														 	  |
|                       	Support:    https://ko-fi.com/glytch3r														    	  |
|_______________________________________________________________________________________________________________________________-]]
--[[_____________________________________________________________________________________________________________________________
   ░▒▓██████▓▒░    ░▒▓████████▓▒░    ░▒▓█▓▒░         ░▒▓█▓▒░      ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓█▓▒░  ░▒█▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒█▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒▓▒░
  ░▒▓█▓▒▒▓███▓▒░   ░▒▓█▓▒░         ░▒▓██████▓▒░      ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█████████▓▒░     ░▒▓███▓▒░     ░▒▓███████▓▒░
  ░▒▓█▓▒░          ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
   ░▒▓█████▓▒░     ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓███████▓▒░   ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓███████▓▒░
█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████--]]



FoodGames = FoodGames or {}
--[[ 

print(tostring(FoodGames.isActiveSkill("MagKneeToe", 1)))
print(tostring(FoodGames.isActiveSkill("MagKneeToe", 2)))
 ]]
function FoodGames.doShotgun()
    local pl = getPlayer()
    local mode = FoodGames.getMode()
    local data = FoodGames.getData()
    if not pl or not mode then return end
    if not (pl:HasTrait("MagKneeToe") and mode == "MagKneeToe") then return end
    if not tostring(WeaponType.getWeaponType(pl)) == "barehand" then return end
    local isSkill1 = FoodGames.isActiveSkill("MagKneeToe", 1)
    local isSkill2 = FoodGames.isActiveSkill("MagKneeToe", 2)

    if isSkill1 then     
        pl:playSound("MagKneeToe_Skill1");
        addSound(pl, pl:getX(), pl:getY(),pl:getZ(), 5, 1);
        FoodGames.doAoE(1)
    end

    if isSkill2 then       
        pl:playSound("MagKneeToe_Skill2")
        addSound(pl, pl:getX(), pl:getY(),pl:getZ(), 5, 1);
        FoodGames.doAoE(2)
    end

end
Events.EveryOneMinute.Add(FoodGames.doShotgun)

function FoodGames.doRoll(percent)
    return percent >= ZombRand(1, 101)
end

function FoodGames.doDmg(zed, skillNum)
    local min = SandboxVars.FoodGames.MinZedDmg1
    local max = SandboxVars.FoodGames.MaxZedDmg1
    if skillNum == 2 then
        min = SandboxVars.FoodGames.MinZedDmg2
        max = SandboxVars.FoodGames.MaxZedDmg2
    end
    local pl = getPlayer()
    if not pl or not zed or not zed:isAlive() then return end

    if FoodGames.consumeEnergy(pl,skillNum) then
        zed:setAttackedBy(pl)
        local dmg = ZombRand(min, max)
        zed:setHealth(zed:getHealth() - dmg)
        zed:playSound("KatanaHit")
        if FoodGames.doRoll(50) then
            zed:setHitReaction("ShotBelly")
        else
            zed:setKnockedDown(true)
        end
    end
    FoodGames.checkEnergyAndDisable(pl, skillNum)
end

function FoodGames.doAoE(skillNum)
    local pl = getPlayer()
    if not pl then return end

    local maxZedCount = SandboxVars.FoodGames.MaxHitCount1
    local rangeLimit = SandboxVars.FoodGames.SkillRadius1

    if skillNum == 2 then
        maxZedCount = SandboxVars.FoodGames.MaxHitCount2
        rangeLimit = SandboxVars.FoodGames.SkillRadius2
    end

    local x, y, z = pl:getX(), pl:getY(), pl:getZ()
    local zombies = getCell():getZombieList()
    if not zombies then return end

    local rangeSq = rangeLimit * rangeLimit
    local sorted = {}

    for i = 0, zombies:size() - 1 do
        local zed = zombies:get(i)
        if zed and not zed:isDead() and zed:getZ() == z then
            local dx = zed:getX() - x
            local dy = zed:getY() - y
            local distSq = dx * dx + dy * dy
            if distSq <= rangeSq then
                table.insert(sorted, { zed = zed, distSq = distSq })
            end
        end
    end

    table.sort(sorted, function(a, b) return a.distSq < b.distSq end)

    for i = 1, math.min(maxZedCount, #sorted) do
        pl:startMuzzleFlash()
        FoodGames.doDmg(sorted[i].zed, skillNum)
    end
end