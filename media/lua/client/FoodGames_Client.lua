--[[██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████
   ░▒▓█████▓▒░     ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓███████▓▒░   ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓███████▓▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
  ░▒▓█▓▒░          ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
  ░▒▓█▓▒▒▓███▓▒░   ░▒▓█▓▒░         ░▒▓██████▓▒░      ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█████████▓▒░     ░▒▓███▓▒░     ░▒▓███████▓▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒▓▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒█▒░
   ░▒▓██████▓▒░    ░▒▓████████▓▒░    ░▒▓█▓▒░         ░▒▓█▓▒░      ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓█▓▒░  ░▒█▒░
|‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾|
|                        				 Custom  PZ  Mod  Developer  for  Hire													  |
|‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾|
|                       	Portfolio:  https://steamcommunity.com/id/glytch3r/myworkshopfiles/							          |
|                       		                                    														 	  |
|                       	Discord:    Glytch3r#1337 / glytch3r															      |
|                       		                                    														 	  |
|                       	Support:    https://ko-fi.com/glytch3r														    	  |
|_______________________________________________________________________________________________________________________________-]]
--[[_____________________________________________________________________________________________________________________________
   ░▒▓██████▓▒░    ░▒▓████████▓▒░    ░▒▓█▓▒░         ░▒▓█▓▒░      ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓█▓▒░  ░▒█▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒█▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒▓▒░
  ░▒▓█▓▒▒▓███▓▒░   ░▒▓█▓▒░         ░▒▓██████▓▒░      ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█████████▓▒░     ░▒▓███▓▒░     ░▒▓███████▓▒░
  ░▒▓█▓▒░          ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
   ░▒▓█████▓▒░     ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓███████▓▒░   ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓███████▓▒░
█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████--]]


-----------------------            ---------------------------
FoodGames = FoodGames or {}
local Commands = {};
Commands.FoodGames = {};

--print(getPlayer():HasTrait("HomeLender") )
FoodGames.hitReactList ={
    ["BEHIND"]="Zed_CatapultedBehindBack",
    ["LEFT"]="Zed_CatapultedLeftFront",
    ["RIGHT"]="Zed_CatapultedRightFront",
    ["FRONT"]="Zed_CatapultedFrontFront",
}

function FoodGames.Catapult(zed, pl, bodyPartType, wpn)
    if not zed or not pl then return end
	if not pl:HasTrait("HomeLender") then return end
    local md = pl:getModData()
    local consume = SandboxVars.FoodGames.CalConsume  or 500
	if md['FoodGames']['Mode'] == "HomeLender" then
        if not md['FoodGames']['consumedCalories'] or md['FoodGames']['consumedCalories'] < consume then
            FoodGames.checkCaloriesAndDisable(pl)
            return
        end

        zed:setAvoidDamage(true)
        local pos = zed:getPlayerAttackPosition()
        -- if not  pl:getModData()['FoodGames']['Catapult'] then return end
        if isClient() then
            sendClientCommand('FoodGames', 'Catapult', {zedID = zed:getOnlineID(), pos = pos})
        else
            FoodGames.doPush(zed, pos)

            md['FoodGames']['consumedCalories'] = md['FoodGames']['consumedCalories'] - consume
            FoodGames.checkCaloriesAndDisable(pl)
        end
        if getCore():getDebug()then
            print(tostring(pos))
            zed:addLineChatElement(tostring(pos))
            local react = (FoodGames.hitReactList[pos])
            if react then
                pl:addLineChatElement(tostring(pos))
            end
        end
        local ShoveKills = SandboxVars.FoodGames.ShoveKills or true
        if ShoveKills then
            timer:Simple(3, function()
                zed:setAvoidDamage(false)
                zed:changeState(ZombieOnGroundState.instance())
                --zed:setAttackedBy(getCell():getFakeZombieForHit())
                zed:setAttackedBy(pl)
                zed:becomeCorpse()
            end)
        end
        --md['FoodGames']['Catapult'] = false
    end
end
Events.OnHitZombie.Remove(FoodGames.Catapult)
Events.OnHitZombie.Add(FoodGames.Catapult)

function FoodGames.findzedID(int)
	local zombies = getCell():getObjectList()
	for i=zombies:size(),1,-1 do
		local zed = zombies:get(i-1)
		if instanceof(zed, "IsoZombie") then
			local zedID=zed:getOnlineID()
			if zedID and zedID == int then return zed end
		end
	end
	return nil
end

Commands.FoodGames.Catapult = function(args)
    local zedID = args.zedID
    local pos = args.pos
    if type(zedID) == 'string' then zedID = tonumber(zedID) end
    local zed = FoodGames.findzedID(zedID)
    if zed then
        FoodGames.doPush(zed, pos)
    end
end

Events.OnServerCommand.Add(function(module, command, args)
	if Commands[module] and Commands[module][command] then
		Commands[module][command](args)
	end
end)

function FoodGames.doPush(zed, pos)
    if not zed then return end
    if not pos then return end

    --local isBehind = zed:getPlayerAttackPosition() == 'BEHIND' or false
    local react = (FoodGames.hitReactList[pos])
    if not react then return end
    zed:setHitReaction("Zed_CatapultedRightFront")
    zed:setPlayerAttackPosition(pos)
    zed:setHitReaction(react)
    zed:setKnockedDown(true)
end
--[[
FoodGames.dbg(dbgZed, true)
FoodGames.dbg(dbgZed, false)
 ]]

-----------------------            ---------------------------

