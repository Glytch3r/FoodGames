--[[██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████
   ░▒▓█████▓▒░     ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓███████▓▒░   ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓███████▓▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
  ░▒▓█▓▒░          ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
  ░▒▓█▓▒▒▓███▓▒░   ░▒▓█▓▒░         ░▒▓██████▓▒░      ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█████████▓▒░     ░▒▓███▓▒░     ░▒▓███████▓▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒▓▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒█▒░
   ░▒▓██████▓▒░    ░▒▓████████▓▒░    ░▒▓█▓▒░         ░▒▓█▓▒░      ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓█▓▒░  ░▒█▒░
|‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾|
|                        				 Custom  PZ  Mod  Developer  for  Hire													  |
|‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾|
|                       	Portfolio:  https://steamcommunity.com/id/glytch3r/myworkshopfiles/							          |
|                       		                                    														 	  |
|                       	Discord:    Glytch3r#1337 / glytch3r															      |
|                       		                                    														 	  |
|                       	Support:    https://ko-fi.com/glytch3r														    	  |
|_______________________________________________________________________________________________________________________________-]]
--[[_____________________________________________________________________________________________________________________________
   ░▒▓██████▓▒░    ░▒▓████████▓▒░    ░▒▓█▓▒░         ░▒▓█▓▒░      ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓█▓▒░  ░▒█▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒█▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒▓▒░
  ░▒▓█▓▒▒▓███▓▒░   ░▒▓█▓▒░         ░▒▓██████▓▒░      ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█████████▓▒░     ░▒▓███▓▒░     ░▒▓███████▓▒░
  ░▒▓█▓▒░          ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
   ░▒▓█████▓▒░     ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓███████▓▒░   ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓███████▓▒░
█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████--]]


-----------------------            ---------------------------
FoodGames = FoodGames or {}
-----------------------            ---------------------------
--[[
function FoodGames.invContext(playerNum, context, worldObjects, test)
	if test then return end
	local pl = getSpecificPlayer(playerNum)
	if not pl or not instanceof(pl, "IsoPlayer") then return end

	for _, obj in ipairs(worldObjects) do
		if instanceof(obj, "IsoObject") then
			local container = obj:getContainer()
			if container and instanceof(container, "ItemContainer") then
				FoodGames.addMetalConsumeOption(context, pl, container)
				break
			end
		end
	end
end

function FoodGames.invPanelContext(playerNum, context, items)
	local pl = getSpecificPlayer(playerNum)
	if not pl or not instanceof(pl, "IsoPlayer") then return end

	local container
	if #items > 0 then
		local entry = items[1]
		local item = entry.items and entry.items[1] or entry
		if item and item.getContainer then
			container = item:getContainer()
		end
	end

	if container and instanceof(container, "ItemContainer") then
		FoodGames.addMetalConsumeOption(context, pl, container)
	end
end

function FoodGames.addMetalConsumeOption(context, pl, container)
	local items = container:getItems()
	local count, total = 0, 0

	for i = 0, items:size() - 1 do
		local item = items:get(i)
		local val = FoodGames.getMetalValue(item)
		if val > 0 then
			count = count + 1
			total = total + val
		end
	end

	if count == 0 then return end

	local opt = context:addOption("Consume All Metal", container, function()
		FoodGames.startConsumeMetalAction(pl, container)
	end)

	local tip = ISToolTip:new()
	tip:initialise()
	tip:setVisible(false)
	tip.description = string.format("Consumes %d item(s)\nYields %.2f metal", count, total)
	opt.toolTip = tip
end

Events.OnFillWorldObjectContextMenu.Remove(FoodGames.invContext)
Events.OnFillWorldObjectContextMenu.Add(FoodGames.invContext)

Events.OnFillInventoryObjectContextMenu.Remove(FoodGames.invPanelContext)
Events.OnFillInventoryObjectContextMenu.Add(FoodGames.invPanelContext) ]]

-----------------------            ---------------------------
function FoodGames.context(player, context, worldobjects, test)
	local pl = getSpecificPlayer(player)
	local sq = clickedSquare
	local targ = clickedPlayer
	local obj = nil
	if not sq then return end

	if not FoodGames.isHero(pl) then return end
--[[     getPlayer():getModData()["FoodGames"] = nil
FoodGames.dataInit() ]]

    local data = FoodGames.getData(pl)    
    local mode = FoodGames.getMode(pl) or pl:getModData()['FoodGames']['Mode'] or  "HomeLender"

    local csq = pl:getCurrentSquare()
    if not mode then
		return
    end

	if csq == sq or getCore():getDebug() then

        local optTip = context:addOptionOnTop("Food Games", worldobjects, function()
            FoodGames.open()
            getSoundManager():playUISound("UIActivateMainMenuItem")
            context:hideAndChildren()
        end)

	
        local ico = "media/ui/FG_Off.png"
        if mode == "HomeLender" then
            ico = "media/ui/FG_HomeLender.png"
        elseif mode == "Wolferine" then
            ico = "media/ui/FG_Wolferine.png"
        elseif mode == "MagKneeToe" then
            ico = "media/ui/FG_MagKneeToe.png"
        end


        optTip.iconTexture = getTexture(ico)
        local tip = ISWorldObjectContextMenu.addToolTip()
        tip:setTexture(ico)
        local calories = data['StoredCalories']
        local metal = data['StoredMetal']
		local storedFood = FoodGames.convertDaysToYMD(tonumber(calories)) or ""


        tip.description = "Hero Mode:\n"..tostring(mode).."\n\n".."Consumed Calories:\n"..tostring(calories).."\n\n".."Stored Food:\n"..tostring(storedFood).."\n\n".."Stored Metal:\n"..tostring(metal)
        optTip.toolTip = tip

    end

end
Events.OnFillWorldObjectContextMenu.Remove(FoodGames.context)
Events.OnFillWorldObjectContextMenu.Add(FoodGames.context)

-----------------------            ---------------------------